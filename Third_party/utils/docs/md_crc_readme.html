<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>utils: crc</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">utils
   </div>
   <div id="projectbrief">utilities in C for microcontrollers</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">crc </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>A library for calculating cyclic redundancy codes. I use <a class="el" href="crc16_8h.html" title="functions for calculating 16 bit cyclic redundancy codes ">crc16.h</a>/c for detecting errors in board to board spi communications in noisy environments and for detecting corruption in eeprom memory caused by failure of the memory hardware or incomplete modifications. Unfortunately this method isn't 100%. There is a possibility of corruption not being detected, but depending on the size of the crc and the size of the data we can make the probability acceptably small.</p>
<h2>how to use</h2>
<ol type="1">
<li>Include <code><a class="el" href="crc16_8h.html" title="functions for calculating 16 bit cyclic redundancy codes ">crc16.h</a></code> and <code>crc16.c</code> in your project.</li>
<li>Initialize a crc of type <code>uint16_t</code> with <code>CRC16_INIT</code>.</li>
<li>Call <code>crc16_update</code> with a pointer to the initialized crc, a pointer to the data over which to calculate the crc, and the size of the data. <code>crc16_update</code> can be called repeatedly on new data as it becomes available.</li>
<li>Finalize the crc with <code>crc = <a class="el" href="crc16_8h.html#a82050d7aca19ec5b126ea40e7b397a37" title="finalize crc value ">CRC16_FINALIZE(crc)</a></code>.</li>
<li>Embed your newly calculated crc with the data you wish to protect, or compare it with the crc that was embedded to determine if the data is valid.</li>
</ol>
<h2>example</h2>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;string.h&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;crc.h&quot;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#define DATA_LEN (9)</span></div><div class="line">uint8_t original_data[DATA_LEN] = {1, 2, 3, 4, 5, 6, 7, 8, 9};</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">void</span>) {</div><div class="line">    <span class="comment">//prepare data that may be corrupted (reserve space for crc)</span></div><div class="line">    uint8_t data_to_send[DATA_LEN + <span class="keyword">sizeof</span>(uint16_t)];</div><div class="line"></div><div class="line">    <span class="comment">//calculate crc</span></div><div class="line">    uint16_t crc = <a class="code" href="crc16_8h.html#ac2f59d153f3abbf2abf1075bbec46fcd">CRC16_INIT</a>;</div><div class="line">    crc16_update(&amp;crc, original_data, DATA_LEN);</div><div class="line">    crc = <a class="code" href="crc16_8h.html#a82050d7aca19ec5b126ea40e7b397a37">CRC16_FINALIZE</a>(crc);</div><div class="line"></div><div class="line">    <span class="comment">//store crc with data</span></div><div class="line">    memcpy(data_to_send, original_data, DATA_LEN);</div><div class="line">    memcpy(data_to_send + DATA_LEN, &amp;crc, <span class="keyword">sizeof</span>(uint16_t));</div><div class="line"></div><div class="line">    <span class="comment">//transmit or save data with crc</span></div><div class="line">    uint8_t received_data[DATA_LEN + <span class="keyword">sizeof</span>(uint16_t)];</div><div class="line">    memcpy(received_data, data_to_send, DATA_LEN + <span class="keyword">sizeof</span>(uint16_t));</div><div class="line"></div><div class="line">    <span class="comment">//oops! the data was corrupted</span></div><div class="line">    received_data[5] ^= 0xFF;</div><div class="line"></div><div class="line">    <span class="comment">//on the other side we re-calculate the crc and compare to the one sent with the data</span></div><div class="line">    uint16_t crc2 = <a class="code" href="crc16_8h.html#ac2f59d153f3abbf2abf1075bbec46fcd">CRC16_INIT</a>;</div><div class="line">    crc16_update(&amp;crc2, data_to_send, DATA_LEN);</div><div class="line">    crc2 = <a class="code" href="crc16_8h.html#a82050d7aca19ec5b126ea40e7b397a37">CRC16_FINALIZE</a>(crc2);</div><div class="line"></div><div class="line">    uint16_t transmitted_crc;</div><div class="line">    memcpy(&amp;transmitted_crc, data_to_send + DATA_LEN, <span class="keyword">sizeof</span>(uint16_t));</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (transmitted_crc != crc2) {</div><div class="line">        printf(<span class="stringliteral">&quot;data is corrupted!\n&quot;</span>);</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">        printf(<span class="stringliteral">&quot;data is ok or data is corrupted but crc is the same (unlikely)\n&quot;</span>);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
